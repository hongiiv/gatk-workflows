2018-10-12 10:58:23,214 INFO  - 07efd1f3-75d2-494e-9fde-c0060751da46-SubWorkflowActor-SubWorkflow-PreProcessTumor:-1:1 [UUID(07efd1f3)]: Starting PreProcessingForVariantDiscovery_GATK4.GetBwaVersion, PreProcessingForVariantDiscovery_GATK4.CreateSequenceGroupingTSV
2018-10-12 10:58:25,819 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.GetBwaVersion:NA:1]: `# Not setting "set -o pipefail" here because /bwa has a rc=1 and we don't want to allow rc=1 to succeed 
# because the sed may also fail with that error and that is something we actually want to fail on.
/usr/gitc/bwa 2>&1 | \
grep -e '^Version' | \
sed 's/Version: //'`
2018-10-12 10:58:25,940 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.CreateSequenceGroupingTSV:NA:1]: `python <<CODE
with open("/cromwell_root/gatk-best-practices/somatic-b37/Homo_sapiens_assembly19.dict", "r") as ref_dict_file:
    sequence_tuple_list = []
    longest_sequence = 0
    for line in ref_dict_file:
        if line.startswith("@SQ"):
            line_split = line.split("\t")
            # (Sequence_Name, Sequence_Length)
            sequence_tuple_list.append((line_split[1].split("SN:")[1], int(line_split[2].split("LN:")[1])))
    longest_sequence = sorted(sequence_tuple_list, key=lambda x: x[1], reverse=True)[0][1]
# We are adding this to the intervals because hg38 has contigs named with embedded colons (:) and a bug in 
# some versions of GATK strips off the last element after a colon, so we add this as a sacrificial element.
hg38_protection_tag = ":1+"
# initialize the tsv string with the first sequence
tsv_string = sequence_tuple_list[0][0] + hg38_protection_tag
temp_size = sequence_tuple_list[0][1]
for sequence_tuple in sequence_tuple_list[1:]:
    if temp_size + sequence_tuple[1] <= longest_sequence:
        temp_size += sequence_tuple[1]
        tsv_string += "\t" + sequence_tuple[0] + hg38_protection_tag
    else:
        tsv_string += "\n" + sequence_tuple[0] + hg38_protection_tag
        temp_size = sequence_tuple[1]
# add the unmapped sequences as a separate line to ensure that they are recalibrated as well
with open("sequence_grouping.txt","w") as tsv_file:
  tsv_file.write(tsv_string)
  tsv_file.close()

tsv_string += '\n' + "unmapped"

with open("sequence_grouping_with_unmapped.txt","w") as tsv_file_with_unmapped:
  tsv_file_with_unmapped.write(tsv_string)
  tsv_file_with_unmapped.close()
CODE`
2018-10-12 10:58:27,355 INFO  - 07efd1f3-75d2-494e-9fde-c0060751da46-SubWorkflowActor-SubWorkflow-PreProcessTumor:-1:1 [UUID(07efd1f3)]: Starting PreProcessingForVariantDiscovery_GATK4.SamToFastqAndBwaMem
2018-10-12 10:58:27,889 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.SamToFastqAndBwaMem:0:1]: `  set -o pipefail
  set -e

  # set the bash variable needed for the command-line
  bash_ref_fasta=/cromwell_root/gatk-best-practices/somatic-b37/Homo_sapiens_assembly19.fasta

java -Dsamjdk.compression_level=5 -Xms3000m -jar /usr/gitc/picard.jar \
    SamToFastq \
	INPUT=/cromwell_root/ngb_cloud/cromwell-execution/FullPipeline/6d58c016-f539-4032-8400-781463555d55/call-PreProcessFastqs/PreProcessFastq.ConvertPairedFastQsToUnmappedBamWf/8a80c037-816b-4dcc-a84a-f7895a737f03/call-PairedFastQsToUnmappedBAM/shard-0/NGB0-075-KOD-NEB-18-2.unmapped.bam \
	FASTQ=/dev/stdout \
	INTERLEAVE=true \
	NON_PF=true \
  | \
/usr/gitc/bwa mem -K 100000000 -p -v 3 -t 16 -Y $bash_ref_fasta /dev/stdin -  2> >(tee NGB0-075-KOD-NEB-18-2.unmapped.unmerged.bwa.stderr.log >&2) \
  | \
samtools view -1 - > NGB0-075-KOD-NEB-18-2.unmapped.unmerged.bam`
2018-10-12 10:58:51,037 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.CreateSequenceGroupingTSV:NA:1]: job id: operations/EOPm_a_mLBiki_7628OEnfMBIMiRiJ3_CyoPcHJvZHVjdGlvblF1ZXVl
2018-10-12 10:58:51,038 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.SamToFastqAndBwaMem:0:1]: job id: operations/EOrm_a_mLBjt_prfmaGf4-wBIMiRiJ3_CyoPcHJvZHVjdGlvblF1ZXVl
2018-10-12 10:58:51,040 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.GetBwaVersion:NA:1]: job id: operations/EObm_a_mLBiu2vLrsLXR5KYBIMiRiJ3_CyoPcHJvZHVjdGlvblF1ZXVl
2018-10-12 10:59:24,093 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.SamToFastqAndBwaMem:0:1]: Status change from - to Running
2018-10-12 10:59:24,097 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.GetBwaVersion:NA:1]: Status change from - to Running
2018-10-12 10:59:24,103 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.CreateSequenceGroupingTSV:NA:1]: Status change from - to Running
2018-10-12 11:01:05,353 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.CreateSequenceGroupingTSV:NA:1]: Status change from Running to Success
2018-10-12 11:02:46,469 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.SamToFastqAndBwaMem:0:1]: Status change from Running to Success
2018-10-12 11:02:46,479 INFO  - PipelinesApiAsyncBackendJobExecutionActor [UUID(07efd1f3)PreProcessingForVariantDiscovery_GATK4.GetBwaVersion:NA:1]: Status change from Running to Success
